generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum CardStatus {
  UNCLAIMED
  CLAIMED
  LOCKED
}

enum CardType {
  CHARACTER
  ITEM
  SPELL
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  createdAt DateTime @default(now())

  cards     Card[]
  runs      Run[]
}

model Card {
  id           String     @id @default(cuid())
  publicCode   String     @unique        // whatâ€™s stored on the NFC tag
  status       CardStatus @default(UNCLAIMED)

  claimedAt    DateTime?  // set when claimed (scan success)
  ownerId      String?
  owner        User?      @relation(fields: [ownerId], references: [id])

  definitionId String
  definition   CardDefinition @relation(fields: [definitionId], references: [id])

  createdAt    DateTime   @default(now())
}

model CardDefinition {
  id          String   @id @default(cuid())
  type        CardType
  name        String
  description String

  rarity      String?   // optional but handy
  effectJson  Json?     // optional flexible rules blob for MVP

  cards       Card[]    // all physical copies of this definition
}
model Character {
  id          String   @id @default(cuid())
  name        String
  archetype   String   // e.g. "Tank", "Rogue", "Mage"
  description String
  createdAt   DateTime @default(now())

  items       Item[]
  runs        Run[]

  // cardDefinitions CardDefinition[]
}

model Item {
  id           String   @id @default(cuid())
  characterId  String
  name         String
  cost         Int
  rarity       String   // "Common" | "Rare" | "Epic" etc
  effectJson   Json     // flexible for now
  createdAt    DateTime @default(now())

  character    Character @relation(fields: [characterId], references: [id])
}

model Run {
  id          String   @id @default(cuid())
  ownerId     String
  characterId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // store state snapshots or events later
  stateJson   Json     @default("{}")

  owner       User      @relation(fields: [ownerId], references: [id])
  character   Character @relation(fields: [characterId], references: [id])
}